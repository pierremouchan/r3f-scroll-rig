import e,{useLayoutEffect as t,useEffect as r,forwardRef as n,useRef as o,useImperativeHandle as l,useMemo as i,Fragment as a,cloneElement as s,Component as c,startTransition as u,useState as d,useCallback as p}from"react";import{useThree as h,invalidate as m,useFrame as g,Canvas as v,createPortal as f,useLoader as w,addEffect as b}from"@react-three/fiber";import{ResizeObserver as y}from"@juggle/resize-observer";import S from"query-string";import{create as R}from"zustand";import{Vector2 as E,Color as C,Scene as T,MathUtils as I,DefaultLoadingManager as O,TextureLoader as L,ImageBitmapLoader as M,Texture as P,CanvasTexture as k}from"three";import{WebGPURenderer as _}from"three/src/Three.WebGPU";import{useInView as x}from"react-intersection-observer";import V from"debounce";import D from"vecn";import{suspend as A}from"suspend-react";import j from"supports-webp";import U from"fast-deep-equal";import z from"lenis";function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Y.apply(null,arguments)}function F(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}function Q(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}const q="undefined"!=typeof window?t:r,W={PRIORITY_PRELOAD:0,PRIORITY_SCISSORS:1,PRIORITY_VIEWPORTS:1,PRIORITY_GLOBAL:1e3,DEFAULT_SCALE_MULTIPLIER:1,preloadQueue:[]},B=R(e=>({debug:!1,scaleMultiplier:W.DEFAULT_SCALE_MULTIPLIER,globalRender:!0,globalPriority:W.PRIORITY_GLOBAL,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!1,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(t,r,n={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,t)?(e[t].instances+=1,e[t].props.inactive=!1,{canvasChildren:e}):{canvasChildren:Y({},e,{[t]:{mesh:r,props:n,instances:1}})}),updateCanvas:(t,r)=>e(({canvasChildren:e})=>{if(!e[t])return;const{[t]:{mesh:n,props:o,instances:l}}=e;return{canvasChildren:Y({},e,{[t]:{mesh:n,props:Y({},o,r),instances:l}})}}),removeFromCanvas:(t,r=!0)=>e(({canvasChildren:e})=>{var n;return(null==(n=e[t])?void 0:n.instances)>1?(e[t].instances-=1,{canvasChildren:e}):r?{canvasChildren:F(e,[t].map(Q))}:(e[t].instances=0,e[t].props.inactive=!0,{canvasChildren:Y({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},__lenis:void 0,scrollTo:()=>{},onScroll:()=>()=>{}})),G=()=>{const e=B(e=>e.requestReflow),t=B(e=>e.debug);return r(()=>{let r=new(window.ResizeObserver||y)(()=>{e(),t&&console.log("ResizeManager","document.body height changed")});return r.observe(document.body),()=>{null==r||r.disconnect()}},[]),null},H=["makeDefault","margin"],X=n((t,r)=>{let{makeDefault:n=!1,margin:a=0}=t,s=F(t,H);const c=h(e=>e.set),u=h(e=>e.camera),d=h(e=>e.size),p=h(e=>e.viewport),m=o(null);l(r,()=>m.current);const g=B(e=>e.pageReflow),v=B(e=>e.scaleMultiplier),{fov:f,distance:w,aspect:b}=i(()=>{var e;const t=(d.height+2*a)*v,r=(d.width+2*a)*v/t;let n=s.fov||50,o=null==s||null==(e=s.position)?void 0:e[2];return o?n=180/Math.PI*2*Math.atan(t/(2*o)):o=t/(2*Math.tan(n/2*Math.PI/180)),{fov:n,distance:o,aspect:r}},[d,v,g]);return q(()=>{m.current.lookAt(0,0,0),m.current.updateProjectionMatrix(),m.current.updateMatrixWorld(),c(e=>({viewport:Y({},e.viewport,p.getCurrentViewport(u))}))},[d,v,g]),q(()=>{if(n){const e=u;return c(()=>({camera:m.current})),()=>c(()=>({camera:e}))}},[m,n,c]),e.createElement("perspectiveCamera",Y({ref:m,position:[0,0,w],onUpdate:e=>e.updateProjectionMatrix(),near:.1,aspect:b,fov:f,far:2*w},s))}),N=["makeDefault","margin"],J=n((t,r)=>{let{makeDefault:n=!1,margin:a=0}=t,s=F(t,N);const c=h(e=>e.set),u=h(e=>e.camera),d=h(e=>e.size),p=B(e=>e.pageReflow),m=B(e=>e.scaleMultiplier),g=i(()=>Math.max(d.width*m,d.height*m),[d,p,m]),v=o(null);return l(r,()=>v.current),q(()=>{v.current.lookAt(0,0,0),v.current.updateProjectionMatrix(),v.current.updateMatrixWorld()},[g,d]),q(()=>{if(n){const e=u;return c(()=>({camera:v.current})),()=>c(()=>({camera:e}))}},[v,n,c]),e.createElement("orthographicCamera",Y({left:d.width*m/-2-a*m,right:d.width*m/2+a*m,top:d.height*m/2+a*m,bottom:d.height*m/-2-a*m,far:2*g,position:[0,0,g],near:.001,ref:v,onUpdate:e=>e.updateProjectionMatrix()},s))});function K(e,t){e&&(!1===t?(e.wasFrustumCulled=e.frustumCulled,e.wasVisible=e.visible,e.visible=!0,e.frustumCulled=!1):(e.visible=!!e.wasVisible,e.frustumCulled=!!e.wasFrustumCulled),e.children.forEach(e=>K(e,t)))}const Z=new E,$=(e=[0])=>{B.getState().globalRenderQueue=B.getState().globalRenderQueue||[0],B.getState().globalRenderQueue=[...B.getState().globalRenderQueue||[],...e]},ee=({gl:e,scene:t,camera:r,left:n,top:o,width:l,height:i,layer:a=0,autoClear:s=!1,clearDepth:c=!1})=>{t&&r&&(e.autoClear=s,e.setScissor(n,o,l,i),e.setScissorTest(!0),r.layers.set(a),c&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1))},te=({gl:e,scene:t,camera:r,left:n,top:o,width:l,height:i,layer:a=0,scissor:s=!0,autoClear:c=!1,clearDepth:u=!1})=>{t&&r&&(e.getSize(Z),e.autoClear=c,e.setViewport(n,o,l,i),e.setScissor(n,o,l,i),e.setScissorTest(s),r.layers.set(a),u&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1),e.setViewport(0,0,Z.x,Z.y))},re=({scene:e,camera:t,layer:r=0},n)=>{W.preloadQueue.push((o,l,i)=>{o.setScissorTest(!1),K(e||l,!1),(t||i).layers.set(r),o.render(e||l,t||i),K(e||l,!0),n&&n()}),m()},ne=()=>{const e=B(e=>e.isCanvasAvailable),t=B(e=>e.hasSmoothScrollbar),n=B(e=>e.requestReflow),o=B(e=>e.pageReflow),l=B(e=>e.debug),i=B(e=>e.scaleMultiplier);return r(()=>{l&&(window._scrollRig=window._scrollRig||{},window._scrollRig.reflow=n)},[]),{debug:l,isCanvasAvailable:e,hasSmoothScrollbar:t,scaleMultiplier:i,preloadScene:re,requestRender:$,renderScissor:ee,renderViewport:te,reflow:n,reflowCompleted:o}},oe=({children:t})=>{const n=h(e=>e.gl),o=B(e=>e.canvasChildren),l=ne();return r(()=>{console.info("gl is WebGPURenderer:",n instanceof _),console.info("gl:",n)},[n]),r(()=>{Object.keys(o).length||(l.debug&&console.log("GlobalRenderer","auto render empty canvas"),n.clear(),l.requestRender(),m())},[o]),l.debug&&console.log("GlobalChildren",Object.keys(o).length),e.createElement(e.Fragment,null,t,Object.keys(o).map(t=>{const{mesh:r,props:n}=o[t];return"function"==typeof r?e.createElement(a,{key:t},r(Y({key:t},l,n))):s(r,Y({key:t},n))}))},le=()=>{const e=h(e=>e.gl),t=h(e=>e.frameloop),r=B(e=>e.globalClearDepth),n=B(e=>e.globalPriority),o=ne();return q(()=>{e.debug.checkShaderErrors=o.debug},[o.debug]),g(({camera:t,scene:r})=>{W.preloadQueue.length&&(W.preloadQueue.forEach(n=>n(e,r,t)),e.clear(),W.preloadQueue=[],o.debug&&console.log("GlobalRenderer","preload complete. trigger global render"),o.requestRender(),m())},W.PRIORITY_PRELOAD),g(({camera:n,scene:o})=>{const l=B.getState().globalRenderQueue;("always"===t||l)&&(n.layers.disableAll(),l?l.forEach(e=>{n.layers.enable(e)}):n.layers.enable(0),r&&e.clearDepth(),e.render(o,n)),B.getState().clearGlobalRenderQueue()},n),null};class ie extends c{constructor(e){super(e),this.state={error:!1},this.props=e}static getDerivedStateFromError(e){return{error:e}}render(){return this.state.error?(this.props.onError&&this.props.onError(this.state.error),null):this.props.children}}var ae="8.15.0";const se=["children","as","style","orthographic","camera","debug","scaleMultiplier","globalRender","globalPriority","globalClearDepth"],ce=["children","onError"];let ue;"undefined"!=typeof window&&(ue=window.ResizeObserver||y);const de=t=>{let{children:r,as:n=v,style:o,orthographic:l,camera:i,debug:a,scaleMultiplier:s=W.DEFAULT_SCALE_MULTIPLIER,globalRender:c=!0,globalPriority:d=W.PRIORITY_GLOBAL,globalClearDepth:p=!1}=t,h=F(t,se);const m=B(e=>e.globalRender);return q(()=>{"undefined"!=typeof window&&(window.__r3f_scroll_rig=ae);const e=S.parse(window.location.search);(a||void 0!==e.debug)&&(B.setState({debug:!0}),console.info("@14islands/r3f-scroll-rig@"+ae))},[a]),q(()=>{u(()=>{B.setState({scaleMultiplier:s,globalRender:c,globalPriority:d,globalClearDepth:p})})},[s,d,c,p]),e.createElement(n,Y({id:"ScrollRig-canvas",camera:{manual:!0},resize:{scroll:!1,debounce:0,polyfill:ue},style:Y({position:"fixed",top:0,left:0,right:0,height:"100vh"},o)},h),!l&&e.createElement(X,Y({manual:!0,makeDefault:!0},i)),l&&e.createElement(J,Y({manual:!0,makeDefault:!0},i)),m&&e.createElement(le,null),"function"==typeof r?r(e.createElement(oe,null)):e.createElement(oe,null,r),e.createElement(G,null))},pe=t=>{let{children:r,onError:n}=t,o=F(t,ce);return q(()=>{document.documentElement.classList.add("js-has-global-canvas"),B.setState({isCanvasAvailable:!0})},[]),e.createElement(ie,{onError:e=>{n&&n(e),B.setState({isCanvasAvailable:!1}),document.documentElement.classList.remove("js-has-global-canvas"),document.documentElement.classList.add("js-global-canvas-error")}},e.createElement(de,Y({},o),r),e.createElement("noscript",null,e.createElement("style",null,"\n          .ScrollRig-visibilityHidden,\n          .ScrollRig-transparentColor {\n            visibility: unset;\n            color: unset;\n          }\n          ")))},he=({scale:t})=>e.createElement("mesh",{scale:t},e.createElement("planeGeometry",null),e.createElement("shaderMaterial",{args:[{uniforms:{color:{value:new C("hotpink")}},vertexShader:"\n            void main() {\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 color;\n            uniform float opacity;\n            void main() {\n              gl_FragColor.rgba = vec4(color, .5);\n            }\n          "}],transparent:!0})),me="undefined"!=typeof window;function ge({debounce:e=0}={}){const[t,n]=d({width:me?window.innerWidth:Infinity,height:me?window.innerHeight:Infinity});return r(()=>{const r=document.getElementById("ScrollRig-canvas");function o(){const e=r?r.clientWidth:window.innerWidth,o=r?r.clientHeight:window.innerHeight;e===t.width&&o===t.height||n({width:e,height:o})}const l=V(o,e),i=window.ResizeObserver||y;let a;return r?(a=new i(l),a.observe(r)):window.addEventListener("resize",l),o(),()=>{var e;window.removeEventListener("resize",l),null==(e=a)||e.disconnect()}},[t,n]),t}function ve(e,t,r,n,o){return n+(e-t)*(o-n)/(r-t)}const fe=()=>({enabled:B(e=>e.hasSmoothScrollbar),scroll:B(e=>e.scroll),scrollTo:B(e=>e.scrollTo),onScroll:B(e=>e.onScroll),__lenis:B(e=>e.__lenis)});function we(e,t){const n=ge(),{scroll:l,onScroll:a}=fe(),s=B(e=>e.scaleMultiplier),c=B(e=>e.pageReflow),u=B(e=>e.debug),{rootMargin:h,threshold:m,autoUpdate:g,wrapper:v}=i(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},r=t||{};return Object.keys(r).map((t,n)=>{void 0!==r[t]&&(e[t]=r[t])}),e},[t]),{ref:f,inView:w}=x({rootMargin:h,threshold:m});q(()=>{f(e.current)},[e,null==e?void 0:e.current]);const[b,y]=d(D.vec3(0,0,0)),S=o({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,R=o({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[E,C]=d(R),T=o({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,I=o(D.vec3(0,0,0)).current;q(()=>{var t;const r=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!r)return;const o=v?v.scrollTop:window.scrollY,l=v?v.scrollLeft:window.scrollX;R.top=r.top+o,R.bottom=r.bottom+o,R.left=r.left+l,R.right=r.right+l,R.width=r.width,R.height=r.height,C(Y({},R)),y(D.vec3((null==R?void 0:R.width)*s,(null==R?void 0:R.height)*s,1)),u&&console.log("useTracker.getBoundingClientRect:",R,"intialScroll:",{initialY:o,initialX:l},"size:",n,"pageReflow:",c)},[e,n,c,s,u]);const O=p(({onlyUpdateInViewport:t=!1,scroll:r}={})=>{if(!e.current||t&&!S.inViewport)return;const o=r||l;!function(e,t,r,n){e.top=t.top-(r.y||0),e.bottom=t.bottom-(r.y||0),e.left=t.left-(r.x||0),e.right=t.right-(r.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*n.width,e.y=e.top+.5*t.height-.5*n.height,e.positiveYUpBottom=n.height-e.bottom}(T,R,o,n),function(e,t,r){e.x=t.x*r,e.y=-1*t.y*r}(I,T,s);const i="horizontal"===o.scrollDirection,a=i?"width":"height",c=n[a]-T[i?"left":"top"];S.progress=ve(c,0,n[a]+T[a],0,1),S.visibility=ve(c,0,T[a],0,1),S.viewport=ve(c,0,n[a],0,1)},[e,n,s,l]);return q(()=>{S.inViewport=w,O({onlyUpdateInViewport:!1}),u&&console.log("useTracker.inViewport:",w,"update()")},[w]),q(()=>{O({onlyUpdateInViewport:!1}),u&&console.log("useTracker.update on resize/reflow")},[O,c]),r(()=>{if(g)return a(e=>O({onlyUpdateInViewport:!0}))},[g,O,a]),{scale:b,inViewport:w,rect:E,bounds:T,position:I,scrollState:S,update:O}}const be=["track","children","margin","inViewportMargin","inViewportThreshold","visible","hideOffscreen","scissor","debug","as","priority","scene"];function ye(t){let{track:n,children:l,margin:i=0,inViewportMargin:a,inViewportThreshold:s,visible:c=!0,hideOffscreen:u=!0,scissor:p=!1,debug:m=!1,as:v="scene",priority:w=W.PRIORITY_SCISSORS,scene:b}=t,y=F(t,be);const S=h(e=>e.scene),R=o(null),[E]=d(b||(p?new T:null)),{requestRender:C,renderScissor:I}=ne(),O=B(e=>e.globalRender),{bounds:L,scale:M,position:P,scrollState:k,inViewport:_}=we(n,{rootMargin:a,threshold:s});q(()=>{R.current&&(R.current.visible=u?_&&c:c)},[_,u,c]),r(()=>{R.current&&(R.current.position.y=P.y,R.current.position.x=P.x)},[M,_]),g(({gl:e,camera:t})=>{R.current&&R.current.visible&&(R.current.position.y=P.y,R.current.position.x=P.x,p?I({gl:e,portalScene:E,camera:t,left:L.left-i,top:L.positiveYUpBottom-i,width:L.width+2*i,height:L.height+2*i}):C())},O?w:void 0);const x=e.createElement(v,{ref:R},(!l||m)&&M&&e.createElement(he,{scale:M}),l&&M&&l(Y({track:n,margin:i,scene:E||S,scale:M,scrollState:k,inViewport:_,priority:w},y)));return E?f(x,E):x}const Se=["track","children","margin","visible","hideOffscreen","debug","orthographic","priority","inViewport","bounds","scale","scrollState","camera","hud","position","rect"],Re=["track","margin","inViewportMargin","inViewportThreshold","priority"],Ee=["bounds"],Ce=t=>{let{track:n,children:o,margin:l=0,visible:i=!0,hideOffscreen:a=!0,debug:s=!1,orthographic:c=!1,priority:u=W.PRIORITY_VIEWPORTS,inViewport:d,bounds:p,scale:m,scrollState:v,camera:f,hud:w}=t,b=F(t,Se);const y=h(e=>e.scene),S=h(e=>e.get),R=h(e=>e.setEvents),{renderViewport:E}=ne();return q(()=>{y.visible=a?d&&i:i},[d,a,i]),r(()=>{const e=S().events.connected;return R({connected:n.current}),()=>R({connected:e})},[]),g(({gl:e,scene:t,camera:r})=>{t.visible&&E({gl:e,scene:t,camera:r,left:p.left-l,top:p.positiveYUpBottom-l,width:p.width+2*l,height:p.height+2*l,clearDepth:!!w})},u),e.createElement(e.Fragment,null,!c&&e.createElement(X,Y({manual:!0,margin:l,makeDefault:!0},f)),c&&e.createElement(J,Y({manual:!0,margin:l,makeDefault:!0},f)),(!o||s)&&m&&e.createElement(he,{scale:m}),o&&m&&o(Y({track:n,margin:l,scale:m,scrollState:v,inViewport:d,priority:u},b)))};function Te(t){let{track:r,margin:n=0,inViewportMargin:o,inViewportThreshold:l,priority:i}=t,a=F(t,Re);const[s]=d(()=>new T),c=we(r,{rootMargin:o,threshold:l}),{bounds:u}=c,h=F(c,Ee),m=p((e,t)=>{if(r.current&&e.target===r.current){const{width:r,height:o,left:l,top:i}=u;t.pointer.set((e.clientX-l+n)/(r+2*n)*2-1,-(e.clientY-i+n)/(o+2*n)*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}},[u]);return u&&f(e.createElement(Ce,Y({track:r,bounds:u,priority:i,margin:n},a,h)),s,{events:{compute:m,priority:i},size:{width:u.width,height:u.height}})}function Ie(e,t={},{key:n,dispose:o=!0}={}){const l=B(e=>e.updateCanvas),a=B(e=>e.renderToCanvas),s=B(e=>e.removeFromCanvas),c=i(()=>n||I.generateUUID(),[]);q(()=>{a(c,e,Y({},t,{inactive:!1}))},[c]),r(()=>()=>{s(c,o)},[c]);const u=p(e=>{l(c,e)},[l,c]);return r(()=>{u(t)},[...Object.values(t)]),u}const Oe=["children","id","dispose"],Le=n((e,t)=>{let{children:r,id:n,dispose:o=!0}=e,l=F(e,Oe);return r?(Ie(r,Y({},l,{id:n,ref:t}),{key:n,dispose:o}),null):null});let Me=!1;function Pe(e,{initTexture:t=!0,premultiplyAlpha:n="none"}={}){var o,l;const a=h(e=>e.gl),s=ge(),c=B(e=>e.debug),[u,p]=d(null==(o=e.current)?void 0:o.currentSrc);r(()=>{const t=e.current,r=()=>{var t;p(null==(t=e.current)?void 0:t.currentSrc)};return null==t||t.addEventListener("load",r),()=>null==t?void 0:t.removeEventListener("load",r)},[e,u,p]);const m=A(()=>(O.itemStart("waiting for DOM image"),new Promise(t=>{const r=e.current;function n(){t(null==r?void 0:r.currentSrc),O.itemEnd("waiting for DOM image")}null==r||r.addEventListener("load",n,{once:!0}),null!=r&&r.complete&&(null==r||r.removeEventListener("load",n),n())})),[e,s,null==(l=e.current)?void 0:l.currentSrc,u],{equal:U}),g=function(){const e=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=navigator.userAgent.indexOf("Firefox")>-1,r=t?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;return"undefined"==typeof createImageBitmap||e||t&&Number(r)<98}()?L:M,v=w(g,m,e=>{e instanceof M&&(e.setOptions({colorSpaceConversion:"none",premultiplyAlpha:n,imageOrientation:"flipY"}),e.setRequestHeader({Accept:(Me?"image/webp,":"")+"*/*"}))}),f=i(()=>v instanceof P?v:v instanceof ImageBitmap?new k(v):void 0,[v]);return r(function(){t&&a.initTexture(f),c&&console.log("useImageAsTexture","initTexture()")},[a,f,t]),f}j.then(e=>{Me=e});const ke=n(({children:e,enabled:t=!0,locked:n=!1,scrollRestoration:i="auto",disablePointerOnScroll:a=!0,horizontal:s=!1,scrollInContainer:c=!1,updateGlobalState:u=!0,onScroll:d,config:h={},invalidate:m=()=>{},addEffect:g},v)=>{const f=o(null),w=o(!1),b=B(e=>e.scroll);l(v,()=>({start:()=>{var e;return null==(e=f.current)?void 0:e.start()},stop:()=>{var e;return null==(e=f.current)?void 0:e.stop()},on:(e,t)=>{var r;return null==(r=f.current)?void 0:r.on(e,t)},scrollTo:(e,t)=>{var r;return null==(r=f.current)?void 0:r.scrollTo(e,t)},raf:e=>{var t;return null==(t=f.current)?void 0:t.raf(e)},__lenis:f.current}));const y=p(e=>{a&&w.current!==e&&(w.current=e,document.documentElement.style.pointerEvents=e?"none":"auto")},[a,w]);return q(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=i)},[]),q(()=>{const e=document.documentElement,r=document.body,n=document.body.firstElementChild;let o;if(e.classList.toggle("ScrollRig-scrollHtml",c),r.classList.toggle("ScrollRig-scrollWrapper",c),c&&Object.assign(h,{smoothTouch:!0,wrapper:r,content:n}),f.current=new z(Y({orientation:s?"horizontal":"vertical"},h,t?{}:{smoothWheel:!1,syncTouch:!1,smoothTouch:!1})),g)o=g(e=>{var t;return null==(t=f.current)?void 0:t.raf(e)});else{let l;function i(e){var t;null==(t=f.current)||t.raf(e),l=requestAnimationFrame(i)}l=requestAnimationFrame(i),o=()=>cancelAnimationFrame(l)}return()=>{var e;o(),null==(e=f.current)||e.destroy()}},[t]),q(()=>{const e=f.current,t=({scroll:e,limit:t,velocity:r,direction:n,progress:o})=>{const l=s?e:0;u&&(b.y=s?0:e,b.x=l,b.limit=t,b.velocity=r,b.direction=n,b.progress=o||0),Math.abs(r)>1.5&&y(!0),Math.abs(r)<1&&y(!1),d&&d({scroll:e,limit:t,velocity:r,direction:n,progress:o}),m()};return null==e||e.on("scroll",t),u&&(b.scrollDirection=s?"horizontal":"vertical",B.setState({__lenis:e||void 0,scrollTo:(...t)=>{null==e||e.scrollTo(...t)},onScroll:t=>(null==e||e.on("scroll",t),null==e||e.emit(),()=>null==e?void 0:e.off("scroll",t))}),B.getState().scroll.y=window.scrollY,B.getState().scroll.x=window.scrollX),null==e||e.emit(),()=>{null==e||e.off("scroll",t),u&&B.setState({__lenis:void 0,onScroll:()=>()=>{},scrollTo:()=>{}})}},[t]),q(()=>{const e=()=>m(),t=()=>y(!1);return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",e),()=>{window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",e)}},[]),r(()=>(u&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",t),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!t),B.setState({hasSmoothScrollbar:t})),()=>{document.documentElement.classList.remove("js-smooth-scrollbar-enabled"),document.documentElement.classList.remove("js-smooth-scrollbar-disabled")}),[t]),r(()=>{var e,t;n?null==(e=f.current)||e.stop():null==(t=f.current)||t.start()},[n]),e?e({}):null});var _e=n(function(t,r){const n=B(e=>e.isCanvasAvailable);return e.createElement(ke,Y(n?{key:"r3f",ref:r,invalidate:m,addEffect:b}:{key:"native",ref:r},t))});const xe={hidden:"ScrollRig-visibilityHidden",hiddenWhenSmooth:"ScrollRig-visibilityHidden ScrollRig-hiddenIfSmooth",transparentColor:"ScrollRig-transparentColor",transparentColorWhenSmooth:"ScrollRig-transparentColor ScrollRig-hiddenIfSmooth"};export{pe as GlobalCanvas,ye as ScrollScene,_e as SmoothScrollbar,Le as UseCanvas,Te as ViewportScrollScene,xe as styles,Ie as useCanvas,B as useCanvasStore,Pe as useImageAsTexture,ne as useScrollRig,fe as useScrollbar,we as useTracker,ge as useWindowSize};
//# sourceMappingURL=scrollrig.modern.js.map
